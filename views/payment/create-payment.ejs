<%- include('../includes/head.ejs') %>
</head>

<%- include('../includes/navigation.ejs') %>

<div class="pcoded-content">
  <div class="pcoded-inner-content">
    <div class="main-body">
      <div class="page-wrapper">

        <!-- Page-header -->
        <div class="page-header">
          <div class="row align-items-end">
            <div class="col-lg-8">
              <div class="page-header-title">
                <div class="d-inline">
                  <h4><%= editing ? "Update Payment" : "Add Payment" %></h4>
                  <span>Manage hotel booking payments</span>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="page-header-breadcrumb">
                <ul class="breadcrumb-title">
                  <li class="breadcrumb-item"><a href="/"> <i class="feather icon-home"></i> </a></li>
                  <li class="breadcrumb-item"><a href="/payments">Payments</a></li>
                  <li class="breadcrumb-item"><a href="#"><%= editing ? "Update Payment" : "Add Payment" %></a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- Page-header end -->

        <div class="page-body">
          <div class="row">
            <div class="col-sm-12">
              <div class="card">
                <div class="card-header">
                  <h5>Payment Form</h5>
                </div>
                <div class="card-block">
                  <div class="j-wrapper j-wrapper-940">

                    <form action="<%= editing ? '/payment/edit/' + oldInput.id : '/payment' %>" method="POST" class="j-pro" id="j-pro" novalidate="">

                      <div class="j-content">

                        <!-- Booking -->
                        <div class="j-row">
                          <div class="j-span12 j-unit">
                            <label class="j-input j-select">
                              <select name="booking" required>
                                <option value="">Select Booking</option>
                                <% bookings.forEach(b => { %>
                                  <option value="<%= b._id %>" <%= oldInput.booking == b._id ? 'selected' : '' %>>
                                    <%= b._id %> - <%= b.room ? b.room.roomNumber + ' (' + b.room.hotelName + ')' : 'N/A' %>
                                  </option>
                                <% }) %>
                              </select>
                            </label>
                          </div>
                        </div>

                        <!-- Transaction ID & Amount -->
                        <div class="j-row">
                          <div class="j-span6 j-unit">
                            <div class="j-input">
                              <label for="transactionId">Transaction ID</label>
                              <input type="text" name="transactionId" id="transactionId" placeholder="Transaction ID" value="<%= oldInput.transactionId %>">
                            </div>
                          </div>

                          <div class="j-span6 j-unit">
                            <div class="j-input">
                              <label for="amount">Amount</label>
                              <input type="number" name="amount" id="amount" placeholder="Amount" value="<%= oldInput.amount %>">
                            </div>
                          </div>
                        </div>

                        <!-- Payment Method & Status -->
                        <div class="j-row">
                          <div class="j-span6 j-unit">
                            <label class="j-input j-select">
                              <select name="method" required>
                                <option value="">Select Payment Method</option>
                                <option value="card" <%= oldInput.method == 'card' ? 'selected' : '' %>>Card</option>
                                <option value="upi" <%= oldInput.method == 'upi' ? 'selected' : '' %>>UPI</option>
                                <option value="wallet" <%= oldInput.method == 'wallet' ? 'selected' : '' %>>Wallet</option>
                                <option value="netbanking" <%= oldInput.method == 'netbanking' ? 'selected' : '' %>>Netbanking</option>
                              </select>
                            </label>
                          </div>

                          <div class="j-span6 j-unit">
                            <label class="j-input j-select">
                              <select name="status" required>
                                <option value="pending" <%= oldInput.status == 'pending' ? 'selected' : '' %>>Pending</option>
                                <option value="success" <%= oldInput.status == 'success' ? 'selected' : '' %>>Success</option>
                                <option value="failed" <%= oldInput.status == 'failed' ? 'selected' : '' %>>Failed</option>
                              </select>
                            </label>
                          </div>
                        </div>

                        <!-- Paid At -->
                        <div class="j-row">
                          <div class="j-span6 j-unit">
                            <div class="j-input">
                              <label for="paidAt">Paid At</label>
                              <input type="datetime-local" name="paidAt" id="paidAt" value="<%= oldInput.paidAt %>">
                            </div>
                          </div>
                        </div>

                        <% if(editing) { %>
                          <input type="hidden" name="paymentId" value="<%= oldInput.id %>">
                        <% } %>

                      </div>

                      <div class="j-footer">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="reset" class="btn btn-default m-r-20">Reset</button>
                      </div>

                    </form>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Page body end -->

      </div>
    </div>
  </div>
</div>

<%- include('../includes/end.ejs') %>
